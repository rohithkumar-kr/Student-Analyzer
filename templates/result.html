<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Analyzer | Executive Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            overflow-y: auto; /* FIX SCROLL */
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .blob {
            position: fixed;
            width: 600px;
            height: 600px;
            filter: blur(120px);
            border-radius: 50%;
            z-index: -1;
            opacity: 0.2;
        }

        .podium-1 { order: 2; transform: translateY(-30px); }
        .podium-2 { order: 1; }
        .podium-3 { order: 3; }

        @media (max-width: 768px) {
            .podium-1,.podium-2,.podium-3 {
                order: unset;
                transform: none;
            }
        }
    </style>
</head>

<body class="selection:bg-indigo-500/30">

<div class="blob top-0 left-0 bg-indigo-600"></div>
<div class="blob bottom-0 right-0 bg-fuchsia-600"></div>

<!-- NAV -->
<nav class="sticky top-0 z-50">
    <div class="glass-panel border-b border-white/5 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-extrabold uppercase">
                Student <span class="text-indigo-400">Analyzer</span>
            </h1>
            <div class="flex gap-3">
                <button onclick="toggleCharts()" class="px-4 py-2 bg-white/5 text-xs font-bold rounded-xl">
                    üìä Charts
                </button>
                <a href="/" class="px-4 py-2 bg-indigo-600 text-white text-xs font-bold rounded-xl">
                    New Analysis
                </a>
            </div>
        </div>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-4 mt-14 space-y-16 pb-24">

<!-- PODIUM -->
<section class="flex flex-col md:flex-row gap-6 max-w-5xl mx-auto">
{% for s in top3_students %}
<div class="glass-panel w-full md:w-1/3 p-8 rounded-[2rem] text-center shadow-2xl
    {% if loop.index==1 %}podium-1{% elif loop.index==2 %}podium-2{% else %}podium-3{% endif %}">
    <div class="text-5xl mb-4">
        {% if loop.index==1 %}üëë{% elif loop.index==2 %}ü•à{% else %}ü•â{% endif %}
    </div>
    <h3 class="text-xl font-black truncate">{{ s.Name }}</h3>
    <p class="text-sm text-indigo-400 mb-3">Rank #{{ loop.index }}</p>
    <p class="text-3xl font-black text-white">{{ s.Average | round(1) }}%</p>
</div>
{% endfor %}
</section>

<!-- PASS / FAIL SUMMARY -->
<section class="max-w-5xl mx-auto">
    <div class="glass-panel rounded-[2rem] grid grid-cols-1 sm:grid-cols-3 divide-y sm:divide-y-0 sm:divide-x divide-white/10">
        <div class="p-6 text-center">
            <p class="text-xs text-gray-400 uppercase">Passed</p>
            <p class="text-4xl font-black text-emerald-400">{{ passed_students }}</p>
        </div>
        <div class="p-6 text-center">
            <p class="text-xs text-gray-400 uppercase">Failed</p>
            <p class="text-4xl font-black text-red-400">{{ failed_students }}</p>
        </div>
        <div class="p-6 text-center">
            <p class="text-xs text-gray-400 uppercase">Pass %</p>
            <p class="text-4xl font-black text-indigo-400">{{ pass_percentage }}%</p>
        </div>
    </div>
</section>

<!-- CHARTS -->
<section id="chartsPanel"
    class="hidden glass-panel rounded-[2rem] p-8 max-w-6xl mx-auto space-y-16">

    <!-- Student Chart -->
    <div>
        <h3 class="font-black mb-4">Student-wise Performance</h3>
        <div class="h-[360px] relative">
            <canvas id="studentChart"></canvas>
            <div id="studentChartError"
                class="hidden absolute inset-0 flex items-center justify-center text-red-400 font-bold">
                ‚ö†Ô∏è Unable to load student chart
            </div>
        </div>
    </div>

    <!-- Subject Chart -->
    <div>
        <h3 class="font-black mb-4">Subject-wise Average</h3>
        <div class="h-[360px] relative">
            <canvas id="subjectChart"></canvas>
            <div id="subjectChartError"
                class="hidden absolute inset-0 flex items-center justify-center text-red-400 font-bold">
                ‚ö†Ô∏è Unable to load subject chart
            </div>
        </div>
    </div>
</section>


<!-- TABLE -->
<section class="glass-panel rounded-[2rem] overflow-hidden">
    <div class="px-6 py-4 border-b border-white/10 flex justify-between">
        <h3 class="font-black">Student Directory</h3>
        <span class="text-xs text-gray-400">{{ students|length }} Records</span>
    </div>

    <table class="w-full text-sm">
        <thead class="bg-black/40 text-gray-400 uppercase">
            <tr>
                <th class="px-4 py-3 text-left">Student</th>
                <th class="px-2 py-3 text-center">Avg</th>
                <th class="px-2 py-3 text-center">Result</th>
                <th class="px-4 py-3 text-right hidden md:table-cell">Grade</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-white/10">
        {% for s in students %}
        <tr>
            <td class="px-4 py-3 font-bold">{{ s.Name }}</td>

            <td class="px-2 py-3 text-center text-indigo-300 font-mono">
                {{ s.Average | round(2) }}%
            </td>

            <td class="px-2 py-3 text-center">
                <div class="flex flex-col items-center gap-1">
                    <span class="px-2 py-0.5 rounded-full text-xs font-bold
                        {% if s.Grade=='F' %}bg-red-500/20 text-red-400{% else %}bg-emerald-500/20 text-emerald-400{% endif %}">
                        {{ 'FAIL' if s.Grade=='F' else 'PASS' }}
                    </span>

                    <!-- MOBILE GRADE -->
                    <span class="md:hidden px-2 py-0.5 rounded-lg text-xs font-bold
                        {% if s.Grade=='A' %}bg-emerald-500/20 text-emerald-400
                        {% elif s.Grade=='B' %}bg-blue-500/20 text-blue-400
                        {% elif s.Grade=='C' %}bg-yellow-500/20 text-yellow-400
                        {% elif s.Grade=='D' %}bg-orange-500/20 text-orange-400
                        {% else %}bg-red-500/20 text-red-400{% endif %}">
                        {{ s.Grade }}
                    </span>
                </div>
            </td>

            <!-- DESKTOP GRADE -->
            <td class="px-4 py-3 text-right hidden md:table-cell">
                <span class="px-3 py-1 rounded-lg font-bold
                    {% if s.Grade=='A' %}bg-emerald-500/20 text-emerald-400
                    {% elif s.Grade=='B' %}bg-blue-500/20 text-blue-400
                    {% elif s.Grade=='C' %}bg-yellow-500/20 text-yellow-400
                    {% elif s.Grade=='D' %}bg-orange-500/20 text-orange-400
                    {% else %}bg-red-500/20 text-red-400{% endif %}">
                    {{ s.Grade }}
                </span>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>

</main>

<footer class="py-8 text-center text-xs text-gray-500">
    ¬© 2026 Student Analyzer
</footer>

<script>
function toggleCharts() {
    const panel = document.getElementById("chartsPanel");
    panel.classList.toggle("hidden");
}

/* COLORS */
const barColors = [
    '#6366f1','#a855f7','#ec4899','#f43f5e',
    '#f97316','#f59e0b','#22c55e'
];

/* STUDENT CHART */
try {
    const studentLabels = {{ students | map(attribute='Name') | list | safe }};
    const studentData = {{ students | map(attribute='Average') | list | safe }};

    new Chart(document.getElementById("studentChart"), {
        type: "bar",
        data: {
            labels: studentLabels,
            datasets: [{
                data: studentData,
                backgroundColor: barColors,
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });
} catch (e) {
    document.getElementById("studentChartError").classList.remove("hidden");
}

/* SUBJECT CHART */
try {
    const subjectLabels = {{ subject_avg.keys() | list | safe }};
    const subjectData = {{ subject_avg.values() | list | safe }};

    new Chart(document.getElementById("subjectChart"), {
        type: "bar",
        data: {
            labels: subjectLabels,
            datasets: [{
                data: subjectData,
                backgroundColor: barColors.slice().reverse(),
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });
} catch (e) {
    document.getElementById("subjectChartError").classList.remove("hidden");
}
</script>


</body>
</html>
